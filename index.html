<!-- === OFFLINE AI BAYAN CHAT (FULL VERSION) === -->
<section id="aiBayanChat" style="max-width:600px;margin:20px auto;text-align:left;background:white;border:2px solid gold;border-radius:12px;padding:10px;">
  <h2 style="text-align:center;color:#002b5c;">ðŸ’¬ Chat with <b>AI Bayan</b></h2>
  <p style="text-align:center;font-size:0.9rem;color:#333;">
    Ask about <b>grammar, vocabulary, translation or homework</b>.<br>
    You can write in English or Russian â€” works fully offline.
  </p>

  <div id="chatBox" style="height:340px;overflow-y:auto;padding:10px;background:#f9f9ff;border-radius:10px;border:1px solid #ccc;">
    <div class="msg ai" style="background:#fffde7;border-left:3px solid gold;border-radius:10px;padding:8px 12px;margin:6px 0;">
      ðŸ‘‹ Hello! I'm AI Bayan. Ask me about English grammar or vocabulary!
    </div>
  </div>

  <div style="display:flex;gap:8px;margin-top:10px;">
    <input id="userInput" type="text" placeholder="Type your message..." style="flex:1;padding:10px;border-radius:8px;border:1px solid #bbb;">
    <button id="sendBtn" style="background:#003366;color:white;border:none;padding:10px 16px;border-radius:8px;font-weight:bold;cursor:pointer;">Send</button>
  </div>
</section>

<script>
const chatBox = document.getElementById("chatBox");
const userInput = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");

sendBtn.addEventListener("click", sendMessage);
userInput.addEventListener("keypress", e => {
  if (e.key === "Enter") {
    e.preventDefault();
    sendMessage();
  }
});

function sendMessage() {
  const text = userInput.value.trim();
  if (!text) return;

  addMessage("user", text);
  userInput.value = "";
  addMessage("ai", "â³ Thinking...");

  setTimeout(() => {
    const reply = getOfflineReply(text);
    replaceLastAIMessage(reply);
  }, 700);
}

function getOfflineReply(text) {
  const msg = text.toLowerCase();

  if (msg.includes("hello") || msg.includes("hi")) return "ðŸ‘‹ Hi there! How are you today?";
  if (msg.includes("how are you")) return "ðŸ˜Š I'm great, thank you! Let's study English together!";
  if (msg.includes("grammar")) return "ðŸ“˜ Grammar tip: use *do/does* for questions in Present Simple!";
  if (msg.includes("vocabulary")) return "ðŸ§  Learn 5 new words a day and use them in sentences!";
  if (msg.includes("translate") || msg.includes("Ð¿ÐµÑ€ÐµÐ²ÐµÐ´Ð¸")) return "ðŸ”¤ Sure! Write the sentence to translate.";
  if (msg.includes("past tense")) return "âŒ› Past tense of *go* â†’ *went*, *see* â†’ *saw*, *have* â†’ *had*.";
  if (msg.includes("thank")) return "ðŸ’› You're welcome!";
  if (msg.includes("who are you")) return "ðŸ¤– I'm AI Bayan â€” your friendly English helper!";
  if (msg.includes("bye")) return "ðŸ‘‹ Bye! Keep practicing your English!";
  if (msg.includes("tense")) return "ðŸ“– English has 12 tenses, but start with Present, Past and Future Simple.";
  if (msg.includes("adjective")) return "âœ¨ Adjectives describe nouns â€” *big, kind, beautiful, smart.*";
  if (msg.includes("noun")) return "ðŸ“— A noun is a person, place or thing â€” *teacher, book, city.*";
  if (msg.includes("verb")) return "ðŸ§© A verb is an action word â€” *run, eat, play.*";
  if (msg.includes("school")) return "ðŸ« School is where we learn, make friends and have fun!";
  if (msg.includes("homework")) return "ðŸ“š Homework helps you remember lessons â€” do a little every day!";
  if (msg.includes("teacher")) return "ðŸ‘©â€ðŸ« Teachers help us learn and grow smarter!";
  if (msg.includes("english")) return "ðŸ’¬ English is fun! The more you practice, the better you become!";
  if (msg.includes("question")) return "â“ Go ahead! Ask your question â€” Iâ€™ll try to help you!";

  return "ðŸ’¬ I'm AI Bayan! Ask me about grammar, words or translation.";
}

function addMessage(sender, text) {
  const div = document.createElement("div");
  div.className = `msg ${sender}`;
  div.style.margin = "8px 0";
  div.style.padding = "8px 12px";
  div.style.borderRadius = "10px";
  div.style.lineHeight = "1.4";
  div.style.whiteSpace = "pre-wrap";
  div.style.wordWrap = "break-word";

  if (sender === "user") {
    div.style.background = "#e3f2fd";
    div.style.borderLeft = "3px solid #1565c0";
  } else {
    div.style.background = "#fffde7";
    div.style.borderLeft = "3px solid gold";
  }

  div.textContent = text;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

function replaceLastAIMessage(newText) {
  const msgs = chatBox.getElementsByClassName("ai");
  if (msgs.length > 0) {
    msgs[msgs.length - 1].textContent = newText;
  }
  chatBox.scrollTop = chatBox.scrollHeight;
}
</script>
